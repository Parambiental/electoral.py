<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Simulador Electoral con Burbuja y Mapa</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      margin: 0;
      padding: 0;
    }
    h1 {
      text-align: center;
      background-color: #003366;
      color: white;
      padding: 15px;
    }
    .container {
      max-width: 700px;
      margin: 30px auto;
      padding: 16px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 8px #0001;
      display: flex;
      flex-direction: column;
      gap: 24px;
    }
    .formulario label {
      font-weight: bold;
      margin-top: 6px;
      color: #444;
      width: 100%;
    }
    .formulario input {
      padding: 8px;
      font-size: 14px;
      width: 100%;
      margin-bottom: 6px;
      border-radius: 4px;
      border: 1px solid #ddd;
    }
    .formulario button {
      background: #006699;
      color: #fff;
      border: none;
      border-radius: 4px;
      font-size: 15px;
      padding: 8px 18px;
      cursor: pointer;
      margin-top: 10px;
    }
    .formulario button:hover {
      background: #004d80;
    }
    .preview {
      background: #e5ddd5;
      border-radius: 10px;
      padding: 20px 10px 10px 10px;
      min-height: 220px;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
    }
    .preview-header {
      font-weight: bold;
      color: #555;
      margin-bottom: 10px;
    }
    .bubble {
      background: #dcf8c6;
      border-radius: 10px 10px 0 10px;
      padding: 14px;
      margin: 10px 0;
      font-size: 15px;
      box-shadow: 0 1px 2px #0001;
      white-space: pre-line;
      max-width: 100%;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
    }
    .bubble img {
      display: block;
      margin: 10px 0 0 0;
      border-radius: 8px;
      width: 100%;
      max-width: 400px;
      aspect-ratio: 2.2/1;
      object-fit: cover;
    }
    .tabla-electores {
      margin-top: 10px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: #fafafa;
    }
    th, td {
      border: 1px solid #eee;
      padding: 7px;
      font-size: 14px;
      text-align: left;
    }
    th {
      background: #f0f0f0;
    }
    .send {
      background: #28a745;
      color: #fff;
      border: none;
      border-radius: 4px;
      padding: 5px 12px;
      cursor: pointer;
      font-size: 14px;
    }
    .send:hover {
      background: #218838;
    }
    .enviar-todos {
      background: #006699;
      color: #fff;
      border: none;
      border-radius: 4px;
      padding: 8px 18px;
      cursor: pointer;
      font-size: 15px;
      margin-bottom: 10px;
      float: right;
    }
    @media (max-width: 700px) {
      .container { padding: 5px; }
      .formulario, .preview { min-width: 100%; }
      table, th, td { font-size: 12px; }
      .bubble img { max-width: 100%; }
    }
  </style>
</head>
<body>
  <h1>üìã Simulador Electoral con Burbuja y Mapa</h1>
  <div class="container">
    <form id="formCandidato" class="formulario">
      <label>Nombre del candidato/a:</label>
      <input type="text" id="candidata" required />
      <label>Lista:</label>
      <input type="text" id="lista" required />
      <label>Movimiento:</label>
      <input type="text" id="movimiento" required />
      <label>Partido:</label>
      <input type="text" id="partido" required />
      <label>Mensaje pol√≠tico:</label>
      <input type="text" id="mensajePolitico" />
      <button type="submit">Aplicar datos del candidato</button>
    </form>

    <div class="preview">
      <div class="preview-header">Vista previa del mensaje</div>
      <div id="mensajePreview" class="bubble">
        Carg√° un candidato y hac√© clic en un elector para ver el mensaje.
      </div>
    </div>

    <div class="tabla-electores">
      <button class="enviar-todos" id="enviarTodos" style="display:none;">Enviar todos</button>
      <table id="tabla" style="display:none;">
        <thead>
          <tr>
            <th>C√©dula</th>
            <th>Nombre</th>
            <th>Tel√©fono</th>
            <th>Local</th>
            <th>Mesa</th>
            <th>Orden</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
  <script>
    // Electores simulados
    const datosElectores = [
      {
        cedula: "1234567",
        nombre: "Juan P√©rez",
        telefono: "0981123456",
        local: "Escuela Herrera",
        mesa: "12",
        orden: "025",
        lat: -25.28,
        lng: -57.57
      },
      {
        cedula: "2345678",
        nombre: "Mar√≠a L√≥pez",
        telefono: "0982345678",
        local: "Colegio San Crist√≥bal",
        mesa: "18",
        orden: "147",
        lat: -25.29,
        lng: -57.58
      },
      {
        cedula: "3456789",
        nombre: "Carlos Romero",
        telefono: "0983456789",
        local: "Esc. B√°sica N¬∞45",
        mesa: "09",
        orden: "098",
        lat: -25.30,
        lng: -57.59
      },
      {
        cedula: "4567890",
        nombre: "Ana Gonz√°lez",
        telefono: "0984567890",
        local: "Centro Educativo Herrera",
        mesa: "21",
        orden: "311",
        lat: -25.27,
        lng: -57.55
      },
      {
        cedula: "5678901",
        nombre: "Pedro Duarte",
        telefono: "0985678901",
        local: "Colegio Nacional",
        mesa: "14",
        orden: "177",
        lat: -25.26,
        lng: -57.54
      }
    ];

    let datosCandidato = null;

    document.getElementById('formCandidato').addEventListener('submit', function (e) {
      e.preventDefault();
      datosCandidato = {
        candidata: document.getElementById('candidata').value,
        lista: document.getElementById('lista').value,
        movimiento: document.getElementById('movimiento').value,
        partido: document.getElementById('partido').value,
        mensaje: document.getElementById('mensajePolitico').value
      };
      mostrarTabla();
    });

    function generarStaticMapURL(lat, lng) {
      // Usamos Yandex Maps gratis, con marcador personalizado (tu √≠cono)
      // Si quieres usar Google Static Maps, necesitar√°s API Key.
      // El √≠cono personalizado debe estar en HTTPS y ser PNG transparente.
      // Usamos el √≠cono de 123rf que pasaste:
      const iconUrl = encodeURIComponent('https://previews.123rf.com/images/tvectoricons/tvectoricons1808/tvectoricons180807503/107693692-location-vector-icon-isolated-on-transparent-background-location-logo-concept.jpg');
      // Yandex permite custom marker con "pm2rdm", pero para imagen personalizada usamos "pl"
      // Documentaci√≥n: https://yandex.com/dev/maps/staticapi/doc/1.x/dg/concepts/input_params-docpage/
      return `https://static-maps.yandex.ru/1.x/?ll=${lng},${lat}&size=520,240&z=16&l=map&pt=${lng},${lat},pm2rdm&pl=${lng},${lat},${iconUrl}`;
    }

    function generarMensajeTexto(d) {
      return `üó≥Ô∏è Ficha Electoral\n\nNombre: ${d.nombre}\nC√©dula: ${d.cedula}\nLocal: ${d.local}\nMesa: ${d.mesa}\nOrden: ${d.orden}\n\n${datosCandidato.candidata} ¬∑ Lista ${datosCandidato.lista} ¬∑ ${datosCandidato.movimiento} ¬∑ ${datosCandidato.partido}\n${datosCandidato.mensaje}`;
    }

    function mostrarPreview(index) {
      const d = datosElectores[index];
      const mensaje = generarMensajeTexto(d);
      const mapUrl = generarStaticMapURL(d.lat, d.lng);
      document.getElementById('mensajePreview').innerHTML = `
        ${mensaje.replace(/\n/g, "<br>")}
        <img src="${mapUrl}" alt="Mapa" />
      `;
    }

    function mostrarTabla() {
      const cuerpo = document.querySelector('#tabla tbody');
      cuerpo.innerHTML = '';
      datosElectores.forEach((d, index) => {
        const telSin0 = d.telefono.replace(/^0/, '');
        const mensaje = generarMensajeTexto(d);
        const linkWA = `https://wa.me/595${telSin0}?text=${encodeURIComponent(mensaje)}`;
        const fila = `
          <tr>
            <td>${d.cedula}</td>
            <td>${d.nombre}</td>
            <td>${d.telefono}</td>
            <td>${d.local}</td>
            <td>${d.mesa}</td>
            <td>${d.orden}</td>
            <td>
              <button class="send" onclick="mostrarPreview(${index})">Ver</button>
              <a href="${linkWA}" target="_blank"><button class="send">Enviar</button></a>
            </td>
          </tr>
        `;
        cuerpo.insertAdjacentHTML('beforeend', fila);
      });
      document.getElementById('tabla').style.display = 'table';
      document.getElementById('enviarTodos').style.display = 'inline-block';
    }

    // Enviar todos (abre cada WhatsApp en una pesta√±a)
    document.getElementById('enviarTodos').onclick = function() {
      if (!datosCandidato) return alert("Primero carg√° los datos del candidato/a.");
      datosElectores.forEach(d => {
        const telSin0 = d.telefono.replace(/^0/, '');
        const mensaje = generarMensajeTexto(d);
        const linkWA = `https://wa.me/595${telSin0}?text=${encodeURIComponent(mensaje)}`;
        window.open(linkWA, '_blank');
      });
    };

    // Exponer mostrarPreview globalmente
    window.mostrarPreview = mostrarPreview;
  </script>
</body>
</html>
